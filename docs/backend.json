{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the RETREAT app, serving as the base for various user roles. All specific profiles (Host, Seeker, Vendor, SpaceOwner) link back to this core user entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user, used for communication and as a unique identifier for login. (Format: email)",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "An optional display name or username for the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user account was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user account was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "createdAt",
        "updatedAt"
      ]
    },
    "HostProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HostProfile",
      "type": "object",
      "description": "Represents the profile of a host who can create and manage retreat listings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HostProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User. (Relationship: User 1:N HostProfile)"
        },
        "companyName": {
          "type": "string",
          "description": "The name of the company or organization managed by the host."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the host's background, expertise, or company mission."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email address for the host. (Format: email)",
          "format": "email"
        },
        "contactPhone": {
          "type": "string",
          "description": "The contact phone number for the host."
        },
        "websiteUrl": {
          "type": "string",
          "description": "The website URL for the host or their company. (Format: uri)",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the host profile was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the host profile was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "companyName",
        "description",
        "contactEmail",
        "createdAt",
        "updatedAt"
      ]
    },
    "SeekerProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SeekerProfile",
      "type": "object",
      "description": "Represents the profile of a seeker who searches and books retreats, vendor services, or spaces.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SeekerProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User. (Relationship: User 1:N SeekerProfile)"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the seeker."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the seeker."
        },
        "preferences": {
          "type": "array",
          "description": "An array of preferred retreat types, activities, or interests (e.g., 'yoga', 'meditation', 'hiking').",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the seeker profile was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the seeker profile was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "firstName",
        "lastName",
        "createdAt",
        "updatedAt"
      ]
    },
    "VendorProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VendorProfile",
      "type": "object",
      "description": "Represents the profile of a vendor who offers services to hosts or retreats (e.g., catering, photography, instruction).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VendorProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User. (Relationship: User 1:N VendorProfile)"
        },
        "companyName": {
          "type": "string",
          "description": "The name of the vendor's company or individual's professional name."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the vendor's services and expertise."
        },
        "vendorType": {
          "type": "string",
          "description": "The type of services the vendor offers (e.g., 'Catering', 'Yoga Instructor', 'Photographer')."
        },
        "servicesOffered": {
          "type": "array",
          "description": "A list of specific services provided by the vendor.",
          "items": {
            "type": "string"
          }
        },
        "pricingDetails": {
          "type": "string",
          "description": "A summary or link to detailed pricing information for the vendor's services."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email address for the vendor. (Format: email)",
          "format": "email"
        },
        "contactPhone": {
          "type": "string",
          "description": "The contact phone number for the vendor."
        },
        "websiteUrl": {
          "type": "string",
          "description": "The website URL for the vendor or their business. (Format: uri)",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the vendor profile was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the vendor profile was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "companyName",
        "description",
        "vendorType",
        "servicesOffered",
        "contactEmail",
        "createdAt",
        "updatedAt"
      ]
    },
    "SpaceOwnerProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SpaceOwnerProfile",
      "type": "object",
      "description": "Represents the profile of a space owner who lists properties for retreats or events.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SpaceOwnerProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User. (Relationship: User 1:N SpaceOwnerProfile)"
        },
        "companyName": {
          "type": "string",
          "description": "The name of the company or individual managing the spaces."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the space owner's business or property management philosophy."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email address for the space owner. (Format: email)",
          "format": "email"
        },
        "contactPhone": {
          "type": "string",
          "description": "The contact phone number for the space owner."
        },
        "websiteUrl": {
          "type": "string",
          "description": "The website URL for the space owner's business. (Format: uri)",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the space owner profile was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the space owner profile was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "companyName",
        "description",
        "contactEmail",
        "createdAt",
        "updatedAt"
      ]
    },
    "Space": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Space",
      "type": "object",
      "description": "Represents a physical space available for rent by a SpaceOwner, suitable for retreats or events.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Space entity."
        },
        "spaceOwnerId": {
          "type": "string",
          "description": "Reference to the SpaceOwnerProfile who owns or manages this space. (Relationship: SpaceOwnerProfile 1:N Space)"
        },
        "name": {
          "type": "string",
          "description": "The name of the space."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the space, its features, and suitability for events."
        },
        "addressLine1": {
          "type": "string",
          "description": "The primary street address of the space."
        },
        "addressLine2": {
          "type": "string",
          "description": "Secondary address information (e.g., apartment, suite, building number)."
        },
        "city": {
          "type": "string",
          "description": "The city where the space is located."
        },
        "stateProvince": {
          "type": "string",
          "description": "The state or province where the space is located."
        },
        "postalCode": {
          "type": "string",
          "description": "The postal code of the space's location."
        },
        "country": {
          "type": "string",
          "description": "The country where the space is located."
        },
        "capacity": {
          "type": "number",
          "description": "The maximum number of people the space can accommodate."
        },
        "amenities": {
          "type": "array",
          "description": "A list of amenities available at the space (e.g., 'WiFi', 'Kitchen', 'Parking', 'Projector').",
          "items": {
            "type": "string"
          }
        },
        "hourlyRate": {
          "type": "number",
          "description": "The hourly rental rate for the space."
        },
        "dailyRate": {
          "type": "number",
          "description": "The daily rental rate for the space."
        },
        "spaceImageIds": {
          "type": "array",
          "description": "References to images associated with this space. (Relationship: Space 1:N SpaceImage)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the space listing was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the space listing was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "spaceOwnerId",
        "name",
        "description",
        "addressLine1",
        "city",
        "stateProvince",
        "postalCode",
        "country",
        "capacity",
        "createdAt",
        "updatedAt"
      ]
    },
    "SpaceImage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SpaceImage",
      "type": "object",
      "description": "Represents an image uploaded for a specific space listing.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SpaceImage entity."
        },
        "spaceId": {
          "type": "string",
          "description": "Reference to the Space this image belongs to. (Relationship: Space 1:N SpaceImage)"
        },
        "imageUrl": {
          "type": "string",
          "description": "The URL or path to the image file. (Format: uri)",
          "format": "uri"
        },
        "description": {
          "type": "string",
          "description": "An optional descriptive caption for the image."
        },
        "uploadedAt": {
          "type": "string",
          "description": "Timestamp when the image was uploaded. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "spaceId",
        "imageUrl",
        "uploadedAt"
      ]
    },
    "Retreat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Retreat",
      "type": "object",
      "description": "Represents a retreat event listing, created and managed by a Host.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Retreat entity."
        },
        "hostId": {
          "type": "string",
          "description": "Reference to the HostProfile who created this retreat. (Relationship: HostProfile 1:N Retreat)"
        },
        "title": {
          "type": "string",
          "description": "The title of the retreat."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the retreat, including activities, schedule, and philosophy."
        },
        "type": {
          "type": "string",
          "description": "The category or type of retreat (e.g., 'Yoga', 'Meditation', 'Wellness', 'Adventure')."
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the retreat. (Format: date)",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the retreat. (Format: date)",
          "format": "date"
        },
        "costPerPerson": {
          "type": "number",
          "description": "The cost per person to attend the retreat."
        },
        "currency": {
          "type": "string",
          "description": "The currency in which the cost is specified (e.g., 'USD', 'EUR', 'GBP')."
        },
        "capacity": {
          "type": "number",
          "description": "The maximum number of attendees for the retreat."
        },
        "currentAttendees": {
          "type": "number",
          "description": "The current number of attendees registered for the retreat."
        },
        "locationDescription": {
          "type": "string",
          "description": "A descriptive string for the retreat's location (e.g., 'Bali, Indonesia', 'Mountain Resort')."
        },
        "spaceId": {
          "type": "string",
          "description": "Optional reference to a specific Space entity where the retreat is held. (Relationship: Space 0:1 Retreat)"
        },
        "vendorIds": {
          "type": "array",
          "description": "References to VendorProfile entities providing services for this retreat. (Relationship: Retreat N:N VendorProfile)",
          "items": {
            "type": "string"
          }
        },
        "retreatImageIds": {
          "type": "array",
          "description": "References to images associated with this retreat. (Relationship: Retreat 1:N RetreatImage)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the retreat listing was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the retreat listing was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "hostId",
        "title",
        "description",
        "type",
        "startDate",
        "endDate",
        "costPerPerson",
        "currency",
        "capacity",
        "locationDescription",
        "createdAt",
        "updatedAt"
      ]
    },
    "RetreatImage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RetreatImage",
      "type": "object",
      "description": "Represents an image uploaded for a specific retreat listing.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RetreatImage entity."
        },
        "retreatId": {
          "type": "string",
          "description": "Reference to the Retreat this image belongs to. (Relationship: Retreat 1:N RetreatImage)"
        },
        "imageUrl": {
          "type": "string",
          "description": "The URL or path to the image file. (Format: uri)",
          "format": "uri"
        },
        "description": {
          "type": "string",
          "description": "An optional descriptive caption for the image."
        },
        "uploadedAt": {
          "type": "string",
          "description": "Timestamp when the image was uploaded. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "retreatId",
        "imageUrl",
        "uploadedAt"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a seeker for a retreat, vendor service, or space.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Booking entity."
        },
        "seekerId": {
          "type": "string",
          "description": "Reference to the SeekerProfile who made the booking. (Relationship: SeekerProfile 1:N Booking)"
        },
        "bookedEntityType": {
          "type": "string",
          "description": "The type of entity being booked (e.g., 'retreat', 'vendor', 'space').",
          "items": {
            "type": "string"
          }
        },
        "bookedEntityId": {
          "type": "string",
          "description": "The ID of the specific entity (Retreat, VendorProfile, or Space) that was booked."
        },
        "quantity": {
          "type": "number",
          "description": "The quantity booked (e.g., number of attendees for a retreat, hours for a space)."
        },
        "startDate": {
          "type": "string",
          "description": "The start date and time for the booking. (Format: date-time)",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date and time for the booking. (Format: date-time)",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total monetary amount for the booking before commissions."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the total amount (e.g., 'USD', 'EUR')."
        },
        "commissionRate": {
          "type": "number",
          "description": "The commission rate applied to this booking (e.g., 0.10 for 10%)."
        },
        "commissionAmount": {
          "type": "number",
          "description": "The calculated commission amount for this booking."
        },
        "status": {
          "type": "string",
          "description": "The current status of the booking (e.g., 'pending', 'confirmed', 'cancelled', 'completed').",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the booking was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the booking was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "seekerId",
        "bookedEntityType",
        "bookedEntityId",
        "quantity",
        "startDate",
        "endDate",
        "totalAmount",
        "currency",
        "commissionRate",
        "commissionAmount",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Records financial transactions related to bookings, including payments, refunds, and payouts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "bookingId": {
          "type": "string",
          "description": "Reference to the Booking associated with this transaction. (Relationship: Booking 1:N Transaction)"
        },
        "paymentGatewayTransactionId": {
          "type": "string",
          "description": "The unique transaction ID provided by the external payment gateway."
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount of the transaction."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the transaction amount (e.g., 'USD', 'EUR')."
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (e.g., 'payment', 'refund', 'payout').",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "The status of the transaction (e.g., 'successful', 'failed', 'pending').",
          "items": {
            "type": "string"
          }
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the transaction occurred. (Format: date-time)",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "An optional description or memo for the transaction."
        }
      },
      "required": [
        "id",
        "bookingId",
        "paymentGatewayTransactionId",
        "amount",
        "currency",
        "type",
        "status",
        "timestamp"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Stores user-generated reviews and ratings for retreats, vendors, or spaces.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Review entity."
        },
        "reviewerId": {
          "type": "string",
          "description": "Reference to the User who submitted the review. (Relationship: User 1:N Review)"
        },
        "reviewedEntityType": {
          "type": "string",
          "description": "The type of entity being reviewed (e.g., 'retreat', 'vendor', 'space').",
          "items": {
            "type": "string"
          }
        },
        "reviewedEntityId": {
          "type": "string",
          "description": "The ID of the specific entity (Retreat, VendorProfile, or Space) that was reviewed."
        },
        "rating": {
          "type": "number",
          "description": "The rating given (e.g., an integer from 1 to 5)."
        },
        "comment": {
          "type": "string",
          "description": "The textual comment or feedback provided by the reviewer."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the review was created. (Format: date-time)",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the review was last updated. (Format: date-time)",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "reviewerId",
        "reviewedEntityType",
        "reviewedEntityId",
        "rating",
        "comment",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores core user account data. This collection acts as the root for user-specific data. Authorization for documents in this collection is strictly tied to `request.auth.uid == userId`."
        }
      },
      {
        "path": "/users/{userId}/seekerProfile/{seekerProfileId}",
        "definition": {
          "entityName": "SeekerProfile",
          "schema": {
            "$ref": "#/backend/entities/SeekerProfile"
          },
          "description": "Stores the private profile details for a seeker. This profile is exclusively accessible by the owner user. `seekerProfileId` is typically identical to `userId` for simplified authorization. Authorization is `request.auth.uid == userId`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (from Firebase Authentication)."
            },
            {
              "name": "seekerProfileId",
              "description": "The unique ID of the seeker profile, typically matching the userId for a 1:1 relationship."
            }
          ]
        }
      },
      {
        "path": "/hosts/{hostId}",
        "definition": {
          "entityName": "HostProfile",
          "schema": {
            "$ref": "#/backend/entities/HostProfile"
          },
          "description": "Stores publicly viewable profiles for hosts. Each document includes a 'userId' field (linking to the core User entity) to enable authorization independence. Hosts can manage their own profile (`request.auth.uid == resource.data.userId`), while all authenticated users can read. Includes denormalized 'userId' for authorization independence."
        }
      },
      {
        "path": "/vendors/{vendorId}",
        "definition": {
          "entityName": "VendorProfile",
          "schema": {
            "$ref": "#/backend/entities/VendorProfile"
          },
          "description": "Stores publicly viewable profiles for vendors. Each document includes a 'userId' field (linking to the core User entity) to enable authorization independence. Vendors can manage their own profile (`request.auth.uid == resource.data.userId`), while all authenticated users can read. Includes denormalized 'userId' for authorization independence."
        }
      },
      {
        "path": "/spaceOwners/{spaceOwnerId}",
        "definition": {
          "entityName": "SpaceOwnerProfile",
          "schema": {
            "$ref": "#/backend/entities/SpaceOwnerProfile"
          },
          "description": "Stores publicly viewable profiles for space owners. Each document includes a 'userId' field (linking to the core User entity) to enable authorization independence. Space owners can manage their own profile (`request.auth.uid == resource.data.userId`), while all authenticated users can read. Includes denormalized 'userId' for authorization independence."
        }
      },
      {
        "path": "/retreats/{retreatId}",
        "definition": {
          "entityName": "Retreat",
          "schema": {
            "$ref": "#/backend/entities/Retreat"
          },
          "description": "Stores details for retreat listings, which are publicly discoverable by seekers. Each document includes 'hostId' for authorization independence. Hosts (`request.auth.uid == resource.data.hostId`) can manage their retreats, while all authenticated users can read. Assumes a 'status' field (e.g., 'PUBLISHED') for public visibility if drafts are present."
        }
      },
      {
        "path": "/retreats/{retreatId}/images/{imageId}",
        "definition": {
          "entityName": "RetreatImage",
          "schema": {
            "$ref": "#/backend/entities/RetreatImage"
          },
          "description": "Stores images associated with a specific retreat. Each document includes denormalized 'hostId' (from the parent Retreat) for authorization independence, allowing the owning host to manage images without `get()` calls to the parent retreat. All authenticated users can read.",
          "params": [
            {
              "name": "retreatId",
              "description": "The unique ID of the retreat."
            },
            {
              "name": "imageId",
              "description": "The unique ID of the retreat image."
            }
          ]
        }
      },
      {
        "path": "/spaces/{spaceId}",
        "definition": {
          "entityName": "Space",
          "schema": {
            "$ref": "#/backend/entities/Space"
          },
          "description": "Stores details for space listings, publicly discoverable. Each document includes 'spaceOwnerId' for authorization independence. Space owners (`request.auth.uid == resource.data.spaceOwnerId`) can manage their spaces, while all authenticated users can read."
        }
      },
      {
        "path": "/spaces/{spaceId}/images/{imageId}",
        "definition": {
          "entityName": "SpaceImage",
          "schema": {
            "$ref": "#/backend/entities/SpaceImage"
          },
          "description": "Stores images associated with a specific space. Each document includes denormalized 'spaceOwnerId' (from the parent Space) for authorization independence, allowing the owning space owner to manage images without `get()` calls to the parent space. All authenticated users can read.",
          "params": [
            {
              "name": "spaceId",
              "description": "The unique ID of the space."
            },
            {
              "name": "imageId",
              "description": "The unique ID of the space image."
            }
          ]
        }
      },
      {
        "path": "/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores details of a booking made by a seeker. To achieve authorization independence, each document includes 'seekerId', 'bookedEntityType', 'bookedEntityId', 'bookedEntityOwnerId' (the ID of the host/vendor/space owner of the booked item), and 'bookedEntityOwnerType'. This allows both the seeker and the relevant owner to access their associated bookings without `get()` calls. Read/Write for seeker, Read for booked entity owner. Backend services handle creation/updates."
        }
      },
      {
        "path": "/bookings/{bookingId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Records financial transactions related to a specific booking. Each document denormalizes 'seekerId', 'bookedEntityOwnerId', and 'bookedEntityOwnerType' from its parent booking for authorization independence, allowing both the seeker and the relevant owner to view transactions without `get()` calls. Read-only for users, write access by backend services (e.g., Cloud Functions).",
          "params": [
            {
              "name": "bookingId",
              "description": "The unique ID of the booking."
            },
            {
              "name": "transactionId",
              "description": "The unique ID of the transaction."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores user reviews and ratings for retreats, vendors, or spaces. Each document includes 'reviewerId', 'reviewedEntityType', 'reviewedEntityId', and denormalized 'reviewedEntityOwnerId' (the ID of the owner of the entity being reviewed) for authorization independence. All authenticated users can read reviews. Only the 'reviewerId' can create, update, or delete their own review."
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to adhere strictly to the core principles of Authorization Independence, Structural Segregation, and clear Access Modeling to ensure security, scalability, and debuggability. A key focus is on eliminating hierarchical authorization dependencies (avoiding `get()` calls in security rules) and enabling efficient, secure `list` operations (QAPs).\n\n**Authorization Independence via Denormalization:**\nThis design heavily relies on denormalization to embed authorization context directly within each document. For instance:\n*   **User Profiles (Host, Vendor, SpaceOwner):** Each `HostProfile`, `VendorProfile`, and `SpaceOwnerProfile` document will explicitly contain a `userId` field (linking to the core Firebase `uid`). This allows security rules for these top-level profile collections to directly check `request.auth.uid == resource.data.userId` without needing to fetch the parent `User` document.\n*   **Images (SpaceImage, RetreatImage):** `SpaceImage` documents, which are subcollections of `/spaces/{spaceId}`, will denormalize `spaceOwnerId` from their parent `Space` document. Similarly, `RetreatImage` documents, subcollections of `/retreats/{retreatId}`, will denormalize `hostId` from their parent `Retreat` document. This means a rule for an `image` document can verify ownership with `request.auth.uid == resource.data.spaceOwnerId` or `request.auth.uid == resource.data.hostId`, making the image document self-authorizing and allowing atomic operations.\n*   **Bookings:** `Booking` documents require multi-party authorization (by the `seeker` and the `host`/`vendor`/`spaceOwner` of the booked entity). Therefore, each `Booking` document explicitly includes `seekerId` (the user who made the booking), `bookedEntityType`, `bookedEntityId`, `bookedEntityOwnerId` (the ID of the owner of the entity being booked, e.g., `hostId`, `vendorId`), and `bookedEntityOwnerType`. This allows rules to grant access to either party (`request.auth.uid == resource.data.seekerId` OR `request.auth.uid == resource.data.bookedEntityOwnerId`) without any `get()` operations.\n*   **Transactions:** As subcollections of `Booking` documents, `Transaction` documents further denormalize `seekerId`, `bookedEntityOwnerId`, and `bookedEntityOwnerType` from their parent `Booking`. This ensures that `Transaction` documents are authorization-independent, providing secure access for both the seeker and the booked entity owner.\n*   **Reviews:** `Review` documents will include `reviewerId`, `reviewedEntityType`, `reviewedEntityId`, and `reviewedEntityOwnerId` (the ID of the owner of the entity that was reviewed, e.g., `hostId` for a reviewed retreat). This enables secure `list` operations for a specific host/vendor/space owner to see reviews pertaining to their listings, and allows the `reviewerId` to manage their own reviews.\n\n**Structural Segregation for QAPs (Rules are not Filters):**\nCollections are designed to have a homogeneous security posture, simplifying security rules and enabling efficient QAPs (Query-Aligned Security Policies).\n*   **Public Listings:** Collections like `/hosts`, `/vendors`, `/spaceOwners`, `/retreats`, and `/spaces` are designed for broad public readership (all authenticated users). Write/update/delete access is strictly limited to the `userId`/`hostId`/`spaceOwnerId` embedded within the respective documents. This segregation ensures that public data can be queried efficiently without security rules needing to filter large sets of data (as the client query should already specify public data if needed, or the rules will only allow publicly readable fields/documents).\n*   **Private User-Specific Data:** `SeekerProfile` is placed as a subcollection `/users/{userId}/seekerProfile/{seekerProfileId}` to strongly link it to the authenticated user, making its access highly restrictive (`request.auth.uid == userId`).\n*   **Bookings and Transactions:** These are sensitive and require specific permissions. By including `seekerId` and `bookedEntityOwnerId` directly, both parties can perform targeted queries to retrieve their relevant bookings or transactions, and the rules can enforce these granular permissions directly on the document data, rather than traversing parent hierarchies or relying on filtering data that shouldn't be accessible at all.\n*   **Reviews:** Reviews are generally public, so `/reviews/{reviewId}` allows all authenticated users to read. Write/update/delete is restricted to the `reviewerId`. Querying for reviews related to a specific `reviewedEntityOwnerId` is efficient due to the denormalized field."
  }
}